<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <changeSet id="create-chats" author="Vaganov.VS">
        <createTable tableName="chats">
            <column name="id" type="uuid" remarks="ИД чата">
                <constraints primaryKey="true"/>
            </column>
            <column name="description" type="varchar" remarks="Описание чата"/>
            <column name="title" type="varchar" remarks="Название чата"/>
            <column name="created_at" type="datetime" remarks="Время создания чата"/>
        </createTable>
    </changeSet>
    <changeSet id="create-chat-members" author="Vaganov.VS">
        <createTable tableName="chat_members">
            <column name="id" type="bigserial" remarks="ИД записи"/>
            <column name="user_id" type="uuid" remarks="ИД пользователя"/>
            <column name="chat_id" type="uuid" remarks="ИД чата"/>
            <column name="chat_role" type="varchar" remarks="Роль пользователя в чате"/>
            <column name="joined_at" type="datetime" remarks="Время присоединения в чат"/>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="chat_members"
                baseColumnNames="user_id"
                constraintName="chat_members_to_users_fk"
                referencedTableName="users"
                referencedColumnNames="id"
                onDelete="CASCADE"/>

        <addForeignKeyConstraint
                baseTableName="chat_members"
                baseColumnNames="chat_id"
                constraintName="chat_members_to_chat_fk"
                referencedTableName="chats"
                referencedColumnNames="id"
                onDelete="CASCADE"/>
    </changeSet>
    <changeSet id="create-chat-messages" author="Vaganov.VS">
        <createTable tableName="chat_messages">
            <column name="chat_id" type="uuid" remarks="ИД чата">
                <constraints nullable="false"/>
            </column>
            <column name="message_id" type="uuid" remarks="ИД сообщения">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addPrimaryKey tableName="chat_messages" columnNames="chat_id,message_id" constraintName="chat_message_pk"/>

        <addForeignKeyConstraint
                baseTableName="chat_messages"
                baseColumnNames="chat_id"
                constraintName="cm_to_chat_fk"
                referencedTableName="chats"
                referencedColumnNames="id"
                onDelete="CASCADE"/>

        <addForeignKeyConstraint
                baseTableName="chat_messages"
                baseColumnNames="message_id"
                constraintName="cm_to_message_fk"
                referencedTableName="messages"
                referencedColumnNames="id"
                onDelete="CASCADE"/>
    </changeSet>
</databaseChangeLog>